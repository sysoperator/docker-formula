{%- from "common/vars.jinja" import
    osfullname, oscodename
with context -%}

{%- set tplroot = tpldir.split('/')[0] -%}
{%- from tplroot ~ "/hostmap.jinja" import hostmap -%}
{%- from tplroot ~ "/osmap.jinja" import osmap -%}
{%- from tplroot ~ "/osfingermap.jinja" import osfingermap -%}

{%- set docker = salt['grains.filter_by'](
  {
    'Debian': {
      'pkg_name': 'docker-ce',
      'version': '5:20.10.23~3-0~' + osfullname + '-' + oscodename
    },
    'RedHat': {}
  },
  grain='os_family',
  merge=salt['grains.filter_by'](osmap, grain='os',
    merge=salt['grains.filter_by'](osfingermap, grain='osfinger',
      merge=salt['grains.filter_by'](hostmap, grain='host',
        merge=salt['pillar.get']('docker:lookup:docker')
      )
    )
  )
) -%}
